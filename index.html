<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Target Tag">
<title>Target Tag</title>
<style>
  :root{
    --bg-a: #ffecd2; --bg-b:#fcb69f; --game-a:#0f1724; --game-b:#073b57; --accent:#ff5e5b; --glass:rgba(255,255,255,0.06);
  }
  *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg-a),var(--bg-b));-webkit-font-smoothing:antialiased}
  #app{max-width:420px;margin:0 auto;height:100vh;display:flex;flex-direction:column;position:relative}

  /* Panels (full-screen) */
  .panel{position:absolute;left:0;right:0;top:0;bottom:72px;padding:16px;display:none;overflow:hidden}
  .panel.active{display:block}
  .panel .card{background:rgba(255,255,255,0.06);border-radius:12px;padding:12px;color:#fff}

  header{display:flex;align-items:center;padding:12px}
  h1{margin:0;font-size:20px;color:#1b2733}
  #coinDisplay{margin-left:auto;background:var(--glass);padding:6px 10px;border-radius:10px;font-weight:700;color:#fff}

  /* Home */
  #home{display:flex;align-items:center;justify-content:center}
  .home-inner{text-align:center;color:#07203a}
  .big-btn{display:inline-block;padding:14px 18px;border-radius:12px;background:linear-gradient(180deg,var(--accent),#ff8a65);color:#fff;font-weight:700;border:none;font-size:16px}

  /* Game area */
  #game{background:linear-gradient(180deg,var(--game-a),var(--game-b));border-radius:12px}
  #gameArea{position:relative;width:100%;height:100%;overflow:hidden;-webkit-tap-highlight-color:transparent}
  .hud{position:absolute;left:12px;top:12px;z-index:80;display:flex;gap:8px}
  .stat{background:rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:#fff;font-weight:700}

  /* crisp bullseye target using SVG background via data URI for perfect scaling */
  .target{position:absolute;width:72px;height:72px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:70;box-shadow:0 8px 24px rgba(0,0,0,0.45);touch-action:none}
  .size-small{width:48px;height:48px}
  .size-medium{width:72px;height:72px}
  .size-large{width:96px;height:96px}
  /* default skin (red) */
  .skin-default{background-image:var(--bullseye-red)}
  .skin-gold{background-image:var(--bullseye-gold)}
  .skin-blue{background-image:var(--bullseye-blue)}
  .skin-silver{background-image:var(--bullseye-silver)}
  .skin-bronze{background-image:var(--bullseye-bronze)}

  /* create data-URI SVGs for crisp targets */
  :root{
    --bullseye-red: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><radialGradient id="g" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="%23ffffff"/><stop offset="25%" stop-color="%23ffefef"/><stop offset="35%" stop-color="%23e3342f"/><stop offset="55%" stop-color="%23ffffff"/><stop offset="70%" stop-color="%23e3342f"/></radialGradient></defs><rect width="100" height="100" rx="50" ry="50" fill="url(%23g)"/></svg>');
    --bullseye-gold: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><radialGradient id="g2"><stop offset="0%" stop-color="%23ffffff"/><stop offset="25%" stop-color="%23fff7df"/><stop offset="35%" stop-color="%23ffd65a"/><stop offset="55%" stop-color="%23ffffff"/><stop offset="70%" stop-color="%23ffb700"/></radialGradient></defs><rect width="100" height="100" rx="50" ry="50" fill="url(%23g2)"/></svg>');
    --bullseye-blue: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><radialGradient id="g3"><stop offset="0%" stop-color="%23ffffff"/><stop offset="25%" stop-color="%23eaf6ff"/><stop offset="35%" stop-color="%2360a5fa"/><stop offset="55%" stop-color="%23ffffff"/><stop offset="70%" stop-color="%232563eb"/></radialGradient></defs><rect width="100" height="100" rx="50" ry="50" fill="url(%23g3)"/></svg>');
    --bullseye-silver: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><radialGradient id="g4"><stop offset="0%" stop-color="%23ffffff"/><stop offset="25%" stop-color="%23f4f7fb"/><stop offset="35%" stop-color="%23e6eef8"/><stop offset="55%" stop-color="%23ffffff"/><stop offset="70%" stop-color="%23cbd5e1"/></radialGradient></defs><rect width="100" height="100" rx="50" ry="50" fill="url(%23g4)"/></svg>');
    --bullseye-bronze: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><radialGradient id="g5"><stop offset="0%" stop-color="%23ffffff"/><stop offset="25%" stop-color="%23fff5ef"/><stop offset="35%" stop-color="%23c77b3a"/><stop offset="55%" stop-color="%23ffffff"/><stop offset="70%" stop-color="%239b4b23"/></radialGradient></defs><rect width="100" height="100" rx="50" ry="50" fill="url(%23g5)"/></svg>');
  }

  /* pop animation */
  .pop{animation:pop 180ms cubic-bezier(.2,.8,.2,1)}
  @keyframes pop{0%{transform:scale(0)}60%{transform:scale(1.12)}100%{transform:scale(1)}}

  /* bottom nav */
  nav{position:fixed;left:0;right:0;bottom:0;height:72px;background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(0,0,0,0.12));display:flex;align-items:center;justify-content:space-around}
  .nav-btn{flex:1;text-align:center;padding:8px;color:#fff;border:none;background:transparent;font-weight:700}
  .nav-btn.active{background:rgba(255,255,255,0.04)}

  /* Shop / Locker list */
  .items{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:10px}
  .item{background:rgba(255,255,255,0.03);padding:10px;border-radius:10px;color:#fff;display:flex;flex-direction:column;align-items:center}
  .item .preview{width:60px;height:60px;border-radius:12px;margin-bottom:8px}

  /* modal */
  .modal{position:fixed;left:12px;right:12px;top:22vh;background:rgba(255,255,255,0.06);padding:16px;border-radius:12px;color:#fff;display:none;z-index:200}
  .modal.active{display:block}
  .modal .row{display:flex;justify-content:space-between;margin-top:8px}

  /* responsive */
  @media(min-width:600px){ #app{margin-top:20px} }
</style>
</head>
<body>
  <div id="app">
    <header>
      <h1>Target Tag</h1>
      <div id="coinDisplay">Coins: 0</div>
    </header>

    <!-- HOME -->
    <section id="home" class="panel active">
      <div class="card" style="margin:12px;">
        <h2>Tap targets. Earn coins. Buy skins & powerups.</h2>
        <div style="margin-top:12px;text-align:center">
          <button id="startBtn" class="big-btn">Start Round</button>
        </div>
        <div style="margin-top:12px">Round length:
          <select id="roundLen">
            <option value="20">20s</option>
            <option value="30" selected>30s</option>
            <option value="60">60s</option>
          </select>
        </div>
        <div id="highScores" style="margin-top:12px;color:#fff"></div>
      </div>
    </section>

    <!-- GAME -->
    <section id="game" class="panel">
      <div id="gameArea"></div>
      <div class="hud" id="hud">
        <div class="stat">Score: <span id="score">0</span></div>
        <div class="stat">Time: <span id="time">0</span></div>
        <div class="stat">Equipped: <span id="equipped">Default</span></div>
      </div>
    </section>

    <!-- SHOP -->
    <section id="shop" class="panel">
      <div class="card">
        <h3>Shop</h3>
        <div class="items" id="shopItems"></div>
      </div>
    </section>

    <!-- LOCKER -->
    <section id="locker" class="panel">
      <div class="card">
        <h3>Locker</h3>
        <div class="items" id="lockerItems"></div>
      </div>
    </section>

    <!-- modal -->
    <div id="endModal" class="modal" role="dialog" aria-modal="true">
      <h3>Round Results</h3>
      <div>Score: <strong id="modalScore">0</strong></div>
      <div>Coins earned: <strong id="modalCoins">0</strong></div>
      <div>Avg time between taps: <strong id="modalAvg">â€”</strong></div>
      <div class="row">
        <button id="modalHome">Home</button>
        <button id="modalPlay">Play Again</button>
      </div>
    </div>

    <nav>
      <button class="nav-btn active" data-target="home">Home</button>
      <button class="nav-btn" data-target="shop">Shop</button>
      <button class="nav-btn" data-target="locker">Locker</button>
    </nav>
  </div>

<script>
// --- Storage ---
const SAVE_KEY = 'target-tag-v5';
const HS_KEY = 'target-tag-hs-v1';
const defaultSave = { coins:0, owned: { default:true }, equipped: 'default' };
let save = loadSave();
function loadSave(){ try{ const raw = localStorage.getItem(SAVE_KEY); return raw? JSON.parse(raw): {...defaultSave}; }catch(e){ return {...defaultSave}; }}
function persist(){ localStorage.setItem(SAVE_KEY, JSON.stringify(save)); updateUI(); }

// highscores
function loadHS(){ try{ const raw = localStorage.getItem(HS_KEY); return raw? JSON.parse(raw): []; }catch(e){ return []; }}
function saveHS(list){ localStorage.setItem(HS_KEY, JSON.stringify(list)); }

// --- DOM refs ---
const panels = { home:document.getElementById('home'), game:document.getElementById('game'), shop:document.getElementById('shop'), locker:document.getElementById('locker') };
const navBtns = document.querySelectorAll('.nav-btn');
const coinDisplay = document.getElementById('coinDisplay');
const scoreEl = document.getElementById('score');
const timeEl = document.getElementById('time');
const equippedEl = document.getElementById('equipped');
const gameArea = document.getElementById('gameArea');
const shopItemsEl = document.getElementById('shopItems');
const lockerItemsEl = document.getElementById('lockerItems');
const highScoresEl = document.getElementById('highScores');

const endModal = document.getElementById('endModal');
const modalScore = document.getElementById('modalScore');
const modalCoins = document.getElementById('modalCoins');
const modalAvg = document.getElementById('modalAvg');

// --- Catalog ---
const catalog = [
  {id:'gold',type:'skin',name:'Gold Target',price:15,cls:'skin-gold'},
  {id:'silver',type:'skin',name:'Silver Target',price:8,cls:'skin-silver'},
  {id:'bronze',type:'skin',name:'Bronze Target',price:5,cls:'skin-bronze'},
  {id:'blue',type:'skin',name:'Blue Target',price:6,cls:'skin-blue'},
  {id:'double',type:'power',name:'Double Points (30s)',price:20,effect:'double',duration:30},
  {id:'slow',type:'power',name:'Slow Spawn (30s)',price:12,effect:'slow',duration:30},
  {id:'rapid',type:'power',name:'Rapid Spawn (15s)',price:10,effect:'rapid',duration:15}
];

// --- Audio (simple FX) ---
const AudioCtx = window.AudioContext || window.webkitAudioContext;
let audioCtx = null;
function ensureAudio(){ if(!audioCtx) audioCtx = new AudioCtx(); }
function playTone(freq, duration=120, type='sine', vol=0.04){ try{ ensureAudio(); const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.type = type; o.frequency.value = freq; g.gain.value = vol; o.connect(g); g.connect(audioCtx.destination); o.start(); o.frequency.exponentialRampToValueAtTime(freq*0.5, audioCtx.currentTime + duration/1000); setTimeout(()=>{ o.stop(); }, duration); }catch(e){} }
function playHit(){ playTone(880,110,'sine',0.06); }
function playSpawn(){ playTone(520,90,'triangle',0.03); }

// vibration
function vibrate(ms){ if(navigator.vibrate) navigator.vibrate(ms); }

// --- Game state ---
let running=false; let score=0; let timeLeft=0; let spawnTimer=null; let tickTimer=null; let lastCoinThreshold=0; let hitsTimestamps=[]; let coinsBeforeRound=0; let activePowerups={double:false,slow:false,rapid:false}; let powerupTimeouts=[];
const sizeMap = { small:48, medium:72, large:96 };

// --- UI helpers ---
function show(panel){ Object.keys(panels).forEach(k=>panels[k].classList.remove('active')); panels[panel].classList.add('active'); navBtns.forEach(b=>b.classList.remove('active')); document.querySelector(`.nav-btn[data-target="${panel}"]`).classList.add('active'); }
navBtns.forEach(b=>b.addEventListener('click',()=>{ show(b.dataset.target); }));

function updateUI(){ coinDisplay.textContent = 'Coins: '+ save.coins; scoreEl.textContent = score; timeEl.textContent = timeLeft; equippedEl.textContent = save.equipped==='default'?'Default': catalog.find(c=>c.id===save.equipped)?.name || save.equipped; buildShop(); buildLocker(); renderHS(); }

// --- build shop & locker ---
function buildShop(){ shopItemsEl.innerHTML=''; catalog.forEach(item=>{ const div=document.createElement('div'); div.className='item'; const preview=document.createElement('div'); preview.className='preview'; if(item.type==='skin'){ const p=document.createElement('div'); p.className=`target size-medium ${item.cls}`; p.style.width='56px'; p.style.height='56px'; preview.appendChild(p); } else { preview.textContent = item.name; } const title=document.createElement('div'); title.textContent=item.name; const price=document.createElement('div'); price.textContent=item.price+' coins'; price.style.opacity=0.9; const btn=document.createElement('button'); btn.textContent = save.owned[item.id]? 'Owned':'Buy'; btn.disabled = !!save.owned[item.id]; btn.addEventListener('click',()=>buy(item)); div.appendChild(preview); div.appendChild(title); div.appendChild(price); div.appendChild(btn); shopItemsEl.appendChild(div); }); }

function buildLocker(){ lockerItemsEl.innerHTML=''; catalog.filter(i=>i.type==='skin').forEach(item=>{ const div=document.createElement('div'); div.className='item'; const preview=document.createElement('div'); preview.className='preview'; const p=document.createElement('div'); p.className=`target size-medium ${item.cls}`; p.style.width='56px'; p.style.height='56px'; preview.appendChild(p); const title=document.createElement('div'); title.textContent=item.name; const btn=document.createElement('button'); if(save.owned[item.id]){ btn.textContent = save.equipped===item.id? 'Equipped':'Equip'; btn.disabled = save.equipped===item.id; btn.addEventListener('click',()=>{ save.equipped=item.id; persist(); }); } else { btn.textContent='Locked'; btn.disabled=true; } div.appendChild(preview); div.appendChild(title); div.appendChild(btn); lockerItemsEl.appendChild(div); });
  // powerups
  catalog.filter(i=>i.type==='power').forEach(item=>{ const div=document.createElement('div'); div.className='item'; const preview=document.createElement('div'); preview.className='preview'; preview.textContent=item.name; const title=document.createElement('div'); title.textContent = item.name + ' â€” ' + item.duration + 's'; const btn=document.createElement('button'); if(save.owned[item.id]){ btn.textContent='Use'; btn.addEventListener('click',()=>usePowerup(item.id)); } else { btn.textContent='Locked'; btn.disabled=true; } div.appendChild(preview); div.appendChild(title); div.appendChild(btn); lockerItemsEl.appendChild(div); }); }

function buy(item){ if(save.owned[item.id]) return; if(save.coins < item.price) return alert('Not enough coins'); save.coins -= item.price; save.owned[item.id]=true; persist(); }

function renderHS(){ const list = loadHS(); highScoresEl.innerHTML=''; if(list.length===0){ highScoresEl.textContent='No high scores yet â€” play to record one!'; return; } list.slice(0,5).forEach((r,idx)=>{ const d=document.createElement('div'); d.style.display='flex'; d.style.justifyContent='space-between'; d.style.padding='6px 0'; d.innerHTML = `<div>#${idx+1} ${r.score}</div><div style="opacity:0.9">${r.avg}</div>`; highScoresEl.appendChild(d); }); }

// --- Game functions ---
function startRound(){ clearRound(); coinsBeforeRound = save.coins; lastCoinThreshold = Math.floor(0/10); hitsTimestamps=[]; activePowerups={double:false,slow:false,rapid:false}; score=0; timeLeft = parseInt(document.getElementById('roundLen').value,10); updateUI(); running=true; spawnLoop(); tickTimer = setInterval(()=>{ timeLeft--; updateUI(); if(timeLeft<=0) endRound(); },1000); show('game'); }

function clearRound(){ running=false; clearInterval(spawnTimer); clearInterval(tickTimer); powerupTimeouts.forEach(t=>clearTimeout(t)); powerupTimeouts=[]; // remove targets
  document.querySelectorAll('.target').forEach(t=>t.remove()); }

function endRound(){ running=false; clearInterval(spawnTimer); clearInterval(tickTimer); // avg time
  let avg='â€”'; if(hitsTimestamps.length>=2){ const diffs=[]; for(let i=1;i<hitsTimestamps.length;i++) diffs.push(hitsTimestamps[i]-hitsTimestamps[i-1]); const meanMs = diffs.reduce((a,b)=>a+b,0)/diffs.length; avg=(meanMs/1000).toFixed(2)+'s'; }
  const coinsEarned = save.coins - coinsBeforeRound; modalScore.textContent = score; modalCoins.textContent = coinsEarned; modalAvg.textContent = avg; // save HS
  try{ const list = loadHS(); list.unshift({score,avg,date:new Date().toISOString()}); list.sort((a,b)=>b.score-a.score); saveHS(list.slice(0,10)); }catch(e){}
  persist(); renderHS(); showModal(); }

function spawnLoop(){ clearInterval(spawnTimer); const base = 900; const factor = activePowerups.rapid?0.45:1; const interval = Math.max(180, base*(activePowerups.slow?1.5:1)*factor); spawnTimer = setInterval(()=>spawnTarget(), interval); }

function spawnTarget(){ if(!running) return; const sizes=['small','medium','large']; const s = sizes[Math.floor(Math.random()*sizes.length)]; const px = sizeMap[s]; const t = document.createElement('div'); const skin = save.equipped && save.equipped!=='default' ? ('skin-'+save.equipped) : 'skin-default'; t.className = `target size-${s} ${skin}`; t.style.width = px+'px'; t.style.height = px+'px'; // position
  const rect = gameArea.getBoundingClientRect(); const padding = 8; const maxLeft = Math.max(0, rect.width - px - padding); const maxTop = Math.max(0, rect.height - px - padding); const left = Math.random()*maxLeft + padding; const top = Math.random()*maxTop + padding; t.style.left = left + 'px'; t.style.top = top + 'px'; t.classList.add('pop');

  const onHit = (ev)=>{ ev.preventDefault(); ev.stopPropagation(); let pts=10; if(s==='small') pts=7; if(s==='large') pts=20; if(activePowerups.double) pts*=2; score += pts; scoreEl.textContent = score; hitsTimestamps.push(Date.now()); // coins
    const coinCount = Math.floor(score/10); if(coinCount>lastCoinThreshold){ const delta = coinCount - lastCoinThreshold; save.coins += delta; lastCoinThreshold = coinCount; persist(); }
    playHit(); vibrate(12); t.remove(); };

  // attach both touch & click
  t.addEventListener('touchstart', onHit, {passive:false});
  t.addEventListener('click', onHit);
  gameArea.appendChild(t);
  playSpawn();
  setTimeout(()=>{ if(t.parentNode) t.remove(); }, 1500);
}

// powerups
function usePowerup(id){ const item = catalog.find(i=>i.id===id); if(!item) return; if(!save.owned[id]) return alert('You do not own this powerup'); if(!running) return alert('Start a round to use powerups'); if(item.effect==='double'){ activePowerups.double=true; powerupTimeouts.push(setTimeout(()=>{ activePowerups.double=false; }, item.duration*1000)); } if(item.effect==='slow'){ activePowerups.slow=true; spawnLoop(); powerupTimeouts.push(setTimeout(()=>{ activePowerups.slow=false; spawnLoop(); }, item.duration*1000)); } if(item.effect==='rapid'){ activePowerups.rapid=true; spawnLoop(); powerupTimeouts.push(setTimeout(()=>{ activePowerups.rapid=false; spawnLoop(); }, item.duration*1000)); } alert(item.name + ' activated for ' + item.duration + 's'); }

// modal
function showModal(){ endModal.classList.add('active'); }
function hideModal(){ endModal.classList.remove('active'); }
document.getElementById('modalHome').addEventListener('click', ()=>{ hideModal(); show('home'); });
document.getElementById('modalPlay').addEventListener('click', ()=>{ hideModal(); startRound(); });

// init bindings
document.getElementById('startBtn').addEventListener('click', ()=>{ startRound(); });

// build initial UI
function init(){ updateUI(); show('home'); }
init();

// try to initialize audio on first touch (iOS requires gesture)
document.addEventListener('touchstart', function initAudio(){ try{ if(!audioCtx) ensureAudio(); document.removeEventListener('touchstart', initAudio); }catch(e){} }, {passive:true});

// persist periodically
setInterval(()=>persist(),5000);

// expose for debugging
window._targetTag = { save, persist, startRound };
</script>
</body>
</html>

